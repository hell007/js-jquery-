<!doctype html>
<html lang="en">
<head>
<title></title>
</head>
<body">
  <div>
    <span class="js-fildate-prev fildate-prev on"></span>
    <div class="fildate-box m-flexlay js-date-picker">
      <div class="fildate-icon">
        <input class="date-picker-input js-date-picker-input" type="date" 
        value="2019-07-24" 
        max="2019-07-24">
        <span class="date-picker-placeholder js-date-picker-placeholder">请选择</span>
      </div>
      <span class="date-picker-display js-date-picker-display">
        2019年7月
      </span>
    </div>
    <span class="fildate-next js-fildate-next"></span>
  </div>
  
</script>
		// 日期
		var datePicker = (function() {
	    var DATEPICKER_INITED_MARK = 'datepicker-inited'
	    var nowYear
	    var nowMonth
	    var nowDay

	    function getNow() {
	    	var D = new Date()
	    	nowYear = D.getFullYear()
		    nowMonth = D.getMonth()
		    nowDay = D.getDate()
		    var mm = (nowMonth+1) > 9 ? (nowMonth+1) : "0" + (nowMonth+1)
		    return nowYear + '-'+ mm
	    }

	    function nextMonth(){
				if(nowMonth >= 11) {
					nowYear +=1;
					nowMonth =0;
				}else{
					nowMonth += 1;
				}
				var m = nowMonth+1
				var mm = m > 9 ? m : "0" + m
				return nowYear + '-'+ mm
			}

			function prevMonth(){
				if(nowMonth <= 0) {
					nowYear -=1;
					nowMonth =11;	
				}else{
					nowMonth -= 1;
				}
				var m = nowMonth+1
				var mm = m > 9 ? m : "0" + m
				return nowYear + '-'+ mm
			}

			function judge(str){
				//var mdate = str.replace("年","-").replace("月","-");
				var arr = str.split('-');
				var d = new Date(); 
	    	curYear = d.getFullYear();
		    curMonth = (d.getMonth()+1);
				if (arr[0] == curYear) {
					return arr[1] <= curMonth ? true : false
				} else {
					return arr[0] < curYear ? true : false
				}
			}

			function identity(x) {
		    return x
		  }

	    function datePicker(picker, formater) {
	      formater = formater || identity
	      $(picker).each(function() {
	        var picker = $(this)
	        if (picker.data(DATEPICKER_INITED_MARK)) {
	          return
	        }
	        var input = picker.find('.js-date-picker-input')
	        var placeholder = picker.find('.js-date-picker-placeholder')
	        var display = picker.find('.js-date-picker-display')

	        input.on('change', function() {
            var value = input.val()
            if (!judge(value)) {
            	alert('日期不能超过当前日期！')
            	return
            }
            display.text(value ? formater(value) : '')
          })

	        display.text(getNow())  	

	        picker.data(DATEPICKER_INITED_MARK, true)
	      })
	    }

	    $('.js-fildate-prev').on('click',function(){
	  		if (!$(this).hasClass('on')) return
	  		var mdate = prevMonth()
	  		console.log(mdate,judge(mdate))
	  		if (judge(mdate)) {
	  			$('.js-fildate-next').addClass('on')
	  		}
	  		$('.js-date-picker-display').text(mdate)
	  	})

	  	$('.js-fildate-next').on('click',function(){
	  		if (!$(this).hasClass('on')) return
	  		var mdate = nextMonth()
	  		console.log(mdate,judge(mdate))
	  		if (!judge(mdate)) {
	  			$('.js-fildate-next').removeClass('on')
	  			return 
	  		}
	  		$('.js-date-picker-display').text(mdate)
	  	})

	    return datePicker
	  })()

	  $(function(){
	  	datePicker('.js-date-picker');
	  })
</body>
</html>
